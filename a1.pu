@startuml LibrarySystem_BookReservation_Sequence_DB
hide footbox
skinparam boundaryBackgroundColor #D5E8D4
skinparam controlBackgroundColor  #F8CECC
skinparam entityBackgroundColor   #DAE8FC

actor Librarian as A
boundary "Menu Screen" as B1
boundary "Book Reservation Screen" as B2
boundary "Reservation Confirmation Screen" as B3
control "ReservationProcessor" as C1

entity "Member Table" as MemberDB
entity "Book Table" as BookDB
entity "Reservation Table" as ReserveDB

== Start Reservation ==
A -> B1: ClickReservationMenu()
activate B1
B1 -> B2: DisplayReservationScreen()
deactivate B1
activate B2

== Member ID Input ==
A -> B2: EnterMemberIDAndConfirm()
B2 -> C1: ValidateMember()
activate C1
C1 -> MemberDB: SearchByMemberID()
activate MemberDB
MemberDB --> C1: 氏名・会員種別
deactivate MemberDB

alt MemberID empty or not registered
    C1 --> B2: DisplayMessage("Please check member ID")
end

C1 --> B2: DisplayMemberInfo()
deactivate C1

== Book Search ==
A -> B2: EnterBookTitleAndSearch()
B2 -> C1: SearchBook()
activate C1

alt Title empty
    C1 --> B2: DisplayMessage("Please enter a book title")
end

alt No matching books
    C1 --> B2: DisplayMessage("No matching books found")
end

C1 -> BookDB: SearchByTitle()
activate BookDB
BookDB --> C1: 図書一覧（書名・著者・出版社・管理番号・貸出状況）
deactivate BookDB
C1 --> B2: DisplayBookList()
deactivate C1

== Book Reservation ==
A -> B2: SelectBookToReserve()
B2 -> C1: RegisterReservation()
activate C1

alt Student reserving magazine
    C1 --> B2: DisplayMessage("Students cannot reserve magazines")
end

alt Book available in stock
    C1 --> B2: DisplayMessage("Book is available, no need to reserve")
end

C1 -> ReserveDB: SaveReservation(ISBN, memberID, reservationDate)
activate ReserveDB
ReserveDB --> C1: 保存完了
deactivate ReserveDB
C1 -> B3: DisplayReservationConfirmation()
deactivate C1
deactivate B2
activate B3

@enduml
